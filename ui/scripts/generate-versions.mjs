import fs from 'node:fs';
import path from 'node:path';

const repoRoot = path.resolve(process.cwd(), '..');
const pkg = JSON.parse(fs.readFileSync(path.join(process.cwd(), 'package.json'), 'utf8'));
const keys = ['next', 'react', 'react-dom', 'tailwindcss', 'wagmi', 'viem', '@rainbow-me/rainbowkit', '@tanstack/react-query', 'zod', 'vitest', 'fast-check', '@playwright/test'];
const all = { ...pkg.dependencies, ...pkg.devDependencies };
const stamp = new Date().toISOString();

const rows = keys.map((k) => `| ${k} | ${all[k] ?? 'n/a'} |`).join('\n');
const markdown = `# UI Versions\n\nGenerated by \`ui/scripts/generate-versions.mjs\`.\n\n- Generated at: ${stamp}\n- Node engine: ${pkg.engines?.node ?? 'unspecified'}\n\n| Package | Pinned Version |\n|---|---|\n${rows}\n`;

const output = path.join(repoRoot, 'docs', 'ui', 'VERSIONS.md');
fs.writeFileSync(output, markdown);
console.log(`Wrote ${path.relative(repoRoot, output)}`);
