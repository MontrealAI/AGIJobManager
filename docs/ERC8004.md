# ERC-8004 integration (off-chain)

AGIJobManager can interoperate with the ERC-8004 agent identity + reputation ecosystem without coupling any critical escrow logic to external calls. This repo provides an **off-chain adapter** that reads AGIJobManager events and emits ERC-8004-friendly reputation artifacts, plus optional tooling hooks for composing feedback actions.

## What is ERC-8004?
ERC-8004 defines a registry for agent identities and a standardized way to publish reputation signals (tags + numeric values) for those identities. In practice, it lets multiple observers (watchers/rankers) publish comparable metrics for the same agent, so consumers can build trust scores and rankings across ecosystems.

## Why no on-chain dependency from AGIJobManager
AGIJobManager’s escrow, dispute resolution, and payout flows must remain **self-contained**. Calling external ERC-8004 contracts in those paths would introduce liveness and dependency risks (e.g., registry downtime, reverts, gas spikes) and could block critical job finalization. This integration is intentionally **off-chain** and **optional**, with no new contract calls or events added to `AGIJobManager.sol`.

## Agent/validator registration
ERC-8004 identities typically expose a JSON registration file referenced by the identity’s `tokenURI`. Use the **`services`** field (not `endpoints`) to advertise how the agent can be reached.

Example registration file: [`integrations/erc8004/examples/registration.json`](../integrations/erc8004/examples/registration.json).

Hosting guidance:
- Host the JSON on IPFS or HTTPS.
- Set the ERC-8004 identity’s `tokenURI` to the hosted file URL.
- Keep `services` stable and update only when contact details change.

## Reputation signals from AGIJobManager events
Watchers/rankers can ingest AGIJobManager events and publish ERC-8004 feedback signals using the `value` + `valueDecimals` scheme. Decimals and negative values are allowed.

Example tag/value encodings:
- `successRate` 99.80% → `value=9980`, `valueDecimals=2`
- `downvote` −1 → `value=-1`, `valueDecimals=0`
- `revenues` $556,000 → `value=556000`, `valueDecimals=0`

Recommended tags (aligned with ERC-8004 best practices):
- `successRate`
- `disputeRate`
- `jobsCompleted`
- `jobsDisputed`
- `responseTime`
- `blocktimeFreshness`
- `revenues`
- `ownerVerified`

See the adapter mapping in [`integrations/erc8004/adapter_spec.md`](../integrations/erc8004/adapter_spec.md).

## Trusted client set (anti-sybil guidance)
For AGIJobManager, a strong eligibility set for submitting feedback is **“addresses that actually created paid jobs.”** Concretely, the trusted set can be derived from `JobCreated` events, using each event’s transaction sender as the employer address. This filters out unverified accounts that never funded jobs.

## Official ERC-8004 sources
- EIP spec: https://eips.ethereum.org/EIPS/eip-8004
- Best practices: https://github.com/erc-8004/best-practices
- Reference contracts: https://github.com/erc-8004/erc-8004-contracts

**Assumptions:** The best-practices and contracts repositories above are maintained by the ERC-8004 authors/maintainers (org `erc-8004`). If your deployment relies on alternative sources, update these links accordingly.
