# ERC‑8004 integration (signaling → enforcement)

AGIJobManager keeps escrow and settlement logic fully on‑chain and avoids external dependencies in critical flows. ERC‑8004 integration is intentionally **off‑chain** in this repository.

## What is ERC‑8004?
ERC‑8004 standardizes how agent identity, reputation, and validation signals are published so other systems can index and consume them consistently.

- EIP: https://eips.ethereum.org/EIPS/eip-8004
- ERC document: https://github.com/ethereum/ERCs/blob/master/ERCS/erc-8004.md
- Reference contracts: https://github.com/erc-8004/erc-8004-contracts

## Why AGIJobManager is not hardwired to ERC‑8004
Coupling escrow settlement to an external registry would introduce **liveness and dependency risks** (e.g., if a registry or indexer is unavailable). AGIJobManager therefore remains a self-contained enforcement layer, while ERC‑8004 operates as a signaling layer.

### What is implemented here vs. off‑chain
- **Implemented in this repo**: escrow/settlement, validator gating, dispute resolution, and reputation updates inside `AGIJobManager`.
- **Off‑chain only**: publishing, indexing, and ranking ERC‑8004 trust signals.

## Recommended integration pattern (no contract changes required)
1. **Publish trust signals** via ERC‑8004 (identity, reputation, validation outcomes).
2. **Index and rank** those signals off‑chain.
3. **Translate policy into allowlists** (Merkle roots at deployment, explicit allowlists/blacklists during operation).
4. **Use AGIJobManager** as the on‑chain escrow and settlement anchor.

## How to combine ERC‑8004 and AGIJobManager in practice
A practical workflow without contract changes:
- Publish ERC‑8004 identity and reputation updates for agents and validators.
- Run an indexer/ranker that produces a trusted set based on those signals.
- Encode the trusted set into the Merkle roots used at deployment, or add addresses to `additionalAgents` / `additionalValidators`.
- Use AGIJobManager to enforce payouts, refunds, and reputation updates.

## Agent/validator registration guidance
Agents and validators should register in ERC‑8004 using a registration file that includes a `services` array. A minimal example lives in:

- `integrations/erc8004/examples/registration.json`

Host the registration JSON via HTTPS or IPFS and reference it from the ERC‑8004 identity token’s metadata (exact field depends on the registry implementation you use).

## Mapping AGIJobManager events to ERC‑8004 signals
AGIJobManager emits job lifecycle events that can be mapped to reputation metrics. The adapter in `integrations/erc8004/` aggregates these into per‑agent metrics, then encodes them as ERC‑8004 signals with `value` and `valueDecimals` (supporting decimals and negative values).

Recommended tag1 examples:
- `successRate`
- `disputeRate`
- `uptime`
- `responseTime`
- `blocktimeFreshness`
- `revenues`
- `ownerVerified`

Encoding examples:
- successRate 99.80% → `value=9980`, `valueDecimals=2`
- downvote −1 → `value=-1`, `valueDecimals=0`
- revenues $556,000 → `value=556000`, `valueDecimals=0`

## Trusted client set guidance
For AGIJobManager feedback, a strong eligibility set for “trusted clients” is: addresses that actually created paid jobs (derived from `JobCreated` events). This reduces sybil feedback and mirrors real economic participation.

## Off‑chain adapter
See the adapter README and spec for how events map into metrics and how to export JSON artifacts:

- `integrations/erc8004/README.md`
- `integrations/erc8004/adapter_spec.md`
