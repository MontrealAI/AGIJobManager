# ERC-8004 integration

This repository keeps AGIJobManager’s escrow logic fully on-chain and **does not** couple job finalization, dispute resolution, or payouts to any external ERC-8004 calls. Instead, we provide an off-chain adapter that consumes AGIJobManager events and produces ERC-8004-friendly reputation artifacts, plus optional tooling to help generate feedback payloads.

## What is ERC-8004 and how it complements AGIJobManager
ERC-8004 (“Trustless Agents”) defines three registries for the agent economy: an identity registry, a reputation registry, and a validation registry. It standardizes how agents advertise identity (via an ERC-721 tokenURI pointing at a registration file), and how reputation signals are published and consumed. In AGIJobManager, those registries complement the existing job lifecycle by allowing third parties to aggregate and publish reputation signals that are **derived** from the job events, while leaving escrow logic unchanged.

**References:**
- ERC-8004 specification: https://eips.ethereum.org/EIPS/eip-8004
- ERC-8004 best practices: https://github.com/erc-8004/best-practices
- ERC-8004 reference contracts: https://github.com/erc-8004/erc-8004-contracts
Assumption: the ERC-8004 team maintains the canonical best-practices and contract repositories under the `erc-8004` GitHub organization; verify the latest links if they change.

## Why we do not hardwire ERC-8004 into escrow logic
We intentionally avoid any mandatory calls to external ERC-8004 registries in the critical escrow path (job completion, dispute resolution, or payouts). This design prevents:
- **Liveness risk** (external registry downtime or reorg issues could block payouts).
- **Dependency risk** (changing external contracts would force upgrades or forks).
- **Gas risk** (job finalization should remain predictable).

Instead, AGIJobManager emits events that can be consumed by off-chain adapters and independent reputation watchers.

## Agent / validator registration in ERC-8004
ERC-8004 identity uses an ERC-721 token where `tokenURI` points to a **registration file**. For AGIJobManager, this registration file should include a `services` array (not “endpoints”) to describe the agent’s A2A/MCP/HTTP interfaces. See the example at `integrations/erc8004/examples/registration.json` and the adapter README for hosting guidance.

## Reputation signals from AGIJobManager events
Reputation watchers should aggregate metrics from AGIJobManager events (see `integrations/erc8004/adapter_spec.md`) and publish ERC-8004 reputation signals with:
- `value` (signed integer)
- `valueDecimals` (precision for decimals, including negative values)

Note: the adapter’s `revenues` metric is a **proxy** equal to the sum of `JobCreated.payout` for completed jobs and may differ from actual transfers if jobs are cancelled or disputes alter payouts.

**Encoding examples:**
- successRate 99.80% → `value=9980`, `valueDecimals=2`
- downvote −1 → `value=-1`, `valueDecimals=0`
- revenues $556,000 → `value=556000`, `valueDecimals=0`

**Recommended tag1 examples (aligned with ERC-8004 best practices):**
- `successRate`
- `disputeRate`
- `uptime`
- `responseTime`
- `blocktimeFreshness`
- `revenues`
- `ownerVerified`
- `jobsCompleted`
- `agentWins`
- `employerWins`

## Trusted client set guidance
To reduce Sybil feedback, an excellent “trusted client set” for AGIJobManager-derived reputation is:
> **addresses that actually created paid jobs** (observed from `JobCreated` events)

This keeps feedback weighted toward real employers who funded jobs on-chain.

## Adapter & tooling
See:
- `integrations/erc8004/README.md` for the quickstart.
- `integrations/erc8004/adapter_spec.md` for the event-to-metric mapping.
- `scripts/erc8004/export_metrics.js` for exporting reputation metrics (dry run).
- `scripts/erc8004/generate_feedback_calldata.js` for generating off-chain feedback actions (dry run by default).
