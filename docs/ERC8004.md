# ERC-8004 integration (off-chain)

This repository keeps AGIJobManager’s escrow and settlement logic fully on-chain and free of any external ERC-8004 dependency. Instead, it provides documentation and off-chain tooling to **bridge AGIJobManager events into ERC-8004 identity + reputation workflows**.

## What is ERC-8004?
ERC-8004 defines an agent identity registry plus a standardized reputation signal format. It enables agents, validators, and external observers to publish reputation artifacts (e.g., success rates, dispute rates, or revenue proxies) in a consistent schema that other systems can consume. For the canonical spec, see the EIP and ERC-8004 best-practices guidance. The contracts repo is linked below. (Assumption: the “best practices” guidance lives in the ERC-8004 spec document.)

- EIP: https://eips.ethereum.org/EIPS/eip-8004
- Best practices (spec doc): https://github.com/ethereum/ERCs/blob/master/ERCS/erc-8004.md
- Reference contracts: https://github.com/erc-8004/erc-8004-contracts

## Why the contract is NOT hardwired to ERC-8004
AGIJobManager intentionally avoids external contract calls in critical escrow paths. Coupling job completion, dispute resolution, or payouts to an external ERC-8004 registry would introduce **liveness and dependency risks** that could block escrow settlement or allow a third-party registry outage to halt payouts. Therefore, ERC-8004 integration is **strictly off-chain** in this repo.

## Agent/validator registration guidance
Agents and validators should register in ERC-8004 using a **registration file** that includes a `services` array (not `endpoints`). A minimal example lives in:

- `integrations/erc8004/examples/registration.json`

Host the registration JSON via HTTPS or IPFS and reference it from the ERC-8004 identity token’s `tokenURI` (or the registry’s metadata field, depending on the specific registry contract you use). Keep URLs stable so watchers can resolve it reliably.

## Metrics from AGIJobManager → ERC-8004 signals
AGIJobManager emits job lifecycle events that can be mapped to reputation metrics. The adapter in `integrations/erc8004/` aggregates these into per-agent metrics, then encodes them as ERC-8004 signals with `value` and `valueDecimals`. **Decimals and negative values are supported** for rate and feedback signals.

Recommended tag1 examples:
- `successRate`
- `disputeRate`
- `uptime`
- `responseTime`
- `blocktimeFreshness`
- `revenues`
- `ownerVerified`

Concrete encoding examples:
- successRate 99.80% → `value=9980`, `valueDecimals=2`
- downvote −1 → `value=-1`, `valueDecimals=0`
- revenues $556,000 → `value=556000`, `valueDecimals=0`

## Trusted client set guidance
For AGIJobManager feedback, a strong eligibility set for “trusted clients” is: **addresses that actually created paid jobs** (derived from `JobCreated` events). This reduces sybil feedback and mirrors real economic participation in the system.

## Off-chain adapter
See the adapter README and spec for how events map into metrics and how to export JSON artifacts:

- `integrations/erc8004/README.md`
- `integrations/erc8004/adapter_spec.md`
